<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Îã®Ïñ¥Ïû• - Scan_Voca</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #F9FAFB;
            color: #111827;
            line-height: 1.6;
        }

        .container {
            max-width: 375px;
            margin: 0 auto;
            background: #FFFFFF;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
        }

        /* Header */
        .header {
            background: #FFFFFF;
            padding: 20px;
            border-bottom: 1px solid #E5E7EB;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
            color: #4F46E5;
            letter-spacing: -0.25px;
        }

        .header p {
            color: #4B5563;
            margin-top: 4px;
            font-size: 14px;
        }

        /* Navigation */
        .nav {
            display: flex;
            background: #FFFFFF;
            border-bottom: 1px solid #E5E7EB;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .nav-item {
            flex: 1;
            padding: 16px 8px;
            text-align: center;
            text-decoration: none;
            color: #9CA3AF;
            font-size: 12px;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .nav-item.active {
            color: #4F46E5;
            border-bottom-color: #4F46E5;
        }

        .nav-item:hover {
            background: #F9FAFB;
            color: #4F46E5;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 2px;
        }

        /* Content */
        .content {
            padding: 20px;
        }


        /* Wordbook List */
        .wordbook-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .wordbook-item {
            background: #FFFFFF;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid #E5E7EB;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            text-decoration: none;
            color: inherit;
            position: relative;
        }

        .wordbook-item:hover {
            border-color: #4F46E5;
            box-shadow: 0 4px 8px rgba(79, 70, 229, 0.15);
            transform: translateY(-1px);
        }

        .wordbook-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            z-index: 1000;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }

        .wordbook-item.drag-over-group {
            border-color: #10B981;
            background: #D1FAE5;
            transform: scale(1.02);
        }

        .wordbook-item.drag-over-reorder {
            border-color: #4F46E5;
            background: #EEF2FF;
            transform: translateY(-2px);
        }

        .wordbook-group.drag-over-reorder {
            border-color: #4F46E5;
            background: #EEF2FF;
            transform: translateY(-2px);
        }

        .wordbook-group.drag-over-group {
            border-color: #10B981;
            background: #ECFDF5;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
        }

        .wordbook-group.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
            z-index: 1000;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }

        .drop-indicator {
            height: 3px;
            background: #4F46E5;
            border-radius: 2px;
            margin: 8px 0;
            opacity: 0;
            transform: scaleY(0);
            transition: all 0.2s ease;
        }

        .drop-indicator.show {
            opacity: 1;
            transform: scaleY(1);
        }

        .drag-handle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: grab;
            color: #9CA3AF;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .wordbook-item:hover .drag-handle,
        .wordbook-group:hover .drag-handle {
            opacity: 1;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .wordbook-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .wordbook-title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
        }

        .wordbook-icon {
            font-size: 20px;
            opacity: 0.7;
        }

        .wordbook-meta {
            font-size: 14px;
            color: #4B5563;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .word-count {
            font-weight: 500;
        }

        .last-studied {
            font-size: 12px;
            color: #9CA3AF;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .progress-text {
            font-size: 12px;
            color: #6B7280;
        }

        .progress-percent {
            font-size: 12px;
            font-weight: 600;
            color: #10B981;
        }

        .mini-progress-bar {
            background: #E5E7EB;
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
        }

        .mini-progress-fill {
            background: linear-gradient(90deg, #10B981, #6EE7B7);
            height: 100%;
            transition: width 0.3s ease-out;
            border-radius: 2px;
        }

        /* New Wordbook Button */
        .new-wordbook-btn {
            width: 100%;
            padding: 16px 24px;
            border: 2px dashed #4F46E5;
            border-radius: 12px;
            background: transparent;
            color: #4F46E5;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
        }

        .new-wordbook-btn:hover {
            background: #F9FAFB;
            border-color: #3730A3;
            color: #3730A3;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: #FFFFFF;
            border-radius: 16px;
            padding: 24px;
            width: 90%;
            max-width: 320px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 16px;
            text-align: center;
        }

        .modal-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: all 0.2s ease;
        }

        .modal-input:focus {
            outline: none;
            border-color: #4F46E5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-btn-cancel {
            background: #F3F4F6;
            color: #6B7280;
        }

        .modal-btn-cancel:hover {
            background: #E5E7EB;
        }

        .modal-btn-confirm {
            background: #4F46E5;
            color: #FFFFFF;
        }

        .modal-btn-confirm:hover {
            background: #3730A3;
        }

        .modal-btn-confirm:disabled {
            background: #D1D5DB;
            cursor: not-allowed;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9CA3AF;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #4B5563;
        }

        .empty-description {
            font-size: 14px;
            line-height: 1.5;
        }

        /* Wordbook Group */
        .wordbook-group {
            background: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            position: relative;
        }

        .wordbook-group:hover {
            border-color: #4F46E5;
            box-shadow: 0 4px 8px rgba(79, 70, 229, 0.1);
        }

        .group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .group-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .group-name {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
        }

        .group-count {
            background: #4F46E5;
            color: white;
            font-size: 12px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }

        .group-toggle {
            color: #6B7280;
            font-size: 14px;
            transition: transform 0.2s ease;
        }

        .group-toggle.expanded {
            transform: rotate(90deg);
        }

        .group-content {
            display: none;
            flex-direction: column;
            gap: 8px;
            padding-left: 12px;
        }

        .group-content.expanded {
            display: flex;
        }

        .group-content .wordbook-item {
            margin-bottom: 0;
            background: #FFFFFF;
            border: 1px solid #E5E7EB;
        }

        .group-content .wordbook-item:hover {
            border-color: #4F46E5;
            transform: translateY(-1px);
        }

        /* Group Creation Modal */
        .group-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .group-modal-overlay.show {
            display: flex;
        }

        .group-modal {
            background: #FFFFFF;
            border-radius: 16px;
            padding: 24px;
            width: 90%;
            max-width: 320px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .group-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 12px;
            text-align: center;
        }

        .group-preview {
            background: #F3F4F6;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
        }

        .group-preview-title {
            font-size: 14px;
            color: #6B7280;
            margin-bottom: 8px;
        }

        .group-preview-items {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .group-preview-item {
            font-size: 14px;
            color: #374151;
            padding: 4px 8px;
            background: #FFFFFF;
            border-radius: 4px;
        }

        /* Wordbook Content Wrapper */
        .wordbook-content {
            flex: 1;
            pointer-events: auto;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ÎÇòÏùò Îã®Ïñ¥Ïû•</h1>
            <p>ÌïôÏäµÌï† Îã®Ïñ¥Ïû•ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
        </div>

        <!-- Navigation -->
        <nav class="nav">
            <a href="home.html" class="nav-item">
                <div class="nav-icon">üè†</div>
                <div>Ìôà</div>
            </a>
            <a href="camera.html" class="nav-item">
                <div class="nav-icon">üì∑</div>
                <div>Ïä§Ï∫î</div>
            </a>
            <a href="wordbook.html" class="nav-item active">
                <div class="nav-icon">üìö</div>
                <div>Îã®Ïñ¥Ïû•</div>
            </a>
            <a href="wordbook-study.html" class="nav-item">
                <div class="nav-icon">üéØ</div>
                <div>ÌïôÏäµ</div>
            </a>
            <a href="wordbook-quiz.html" class="nav-item">
                <div class="nav-icon">üß†</div>
                <div>ÌÄ¥Ï¶à</div>
            </a>
        </nav>

        <!-- Content -->
        <div class="content">

            <!-- Wordbook List -->
            <div class="wordbook-list" id="wordbookList">
                <div class="wordbook-item" draggable="true" data-wordbook-id="1">
                    <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    <div class="wordbook-content">
                        <div class="wordbook-header">
                            <div class="wordbook-title">Í∏∞Ï¥à ÏòÅÎã®Ïñ¥</div>
                            <div class="wordbook-icon">üìñ</div>
                        </div>
                        <div class="wordbook-meta">
                            <span class="word-count">32Í∞ú Îã®Ïñ¥</span>
                            <span class="last-studied">2ÏãúÍ∞Ñ Ï†Ñ</span>
                        </div>
                        <div class="progress-info">
                            <span class="progress-text">ÌïôÏäµ ÏßÑÌñâÎ•†</span>
                            <span class="progress-percent">85%</span>
                        </div>
                        <div class="mini-progress-bar">
                            <div class="mini-progress-fill" style="width: 85%;"></div>
                        </div>
                    </div>
                </div>

                <div class="wordbook-item" draggable="true" data-wordbook-id="2">
                    <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    <div class="wordbook-content">
                        <div class="wordbook-header">
                            <div class="wordbook-title">ÌÜ†Ïùµ ÌïÑÏàò Îã®Ïñ¥</div>
                            <div class="wordbook-icon">üíº</div>
                        </div>
                        <div class="wordbook-meta">
                            <span class="word-count">156Í∞ú Îã®Ïñ¥</span>
                            <span class="last-studied">1Ïùº Ï†Ñ</span>
                        </div>
                        <div class="progress-info">
                            <span class="progress-text">ÌïôÏäµ ÏßÑÌñâÎ•†</span>
                            <span class="progress-percent">67%</span>
                        </div>
                        <div class="mini-progress-bar">
                            <div class="mini-progress-fill" style="width: 67%;"></div>
                        </div>
                    </div>
                </div>

                <div class="wordbook-item" draggable="true" data-wordbook-id="3">
                    <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    <div class="wordbook-content">
                        <div class="wordbook-header">
                            <div class="wordbook-title">ÏùºÏÉÅ ÌöåÌôî ÌëúÌòÑ</div>
                            <div class="wordbook-icon">üí¨</div>
                        </div>
                        <div class="wordbook-meta">
                            <span class="word-count">89Í∞ú Îã®Ïñ¥</span>
                            <span class="last-studied">3Ïùº Ï†Ñ</span>
                        </div>
                        <div class="progress-info">
                            <span class="progress-text">ÌïôÏäµ ÏßÑÌñâÎ•†</span>
                            <span class="progress-percent">42%</span>
                        </div>
                        <div class="mini-progress-bar">
                            <div class="mini-progress-fill" style="width: 42%;"></div>
                        </div>
                    </div>
                </div>

                <div class="wordbook-item" draggable="true" data-wordbook-id="4">
                    <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    <div class="wordbook-content">
                        <div class="wordbook-header">
                            <div class="wordbook-title">Ïä§Ï∫îÌïú Îã®Ïñ¥Îì§</div>
                            <div class="wordbook-icon">üì∑</div>
                        </div>
                        <div class="wordbook-meta">
                            <span class="word-count">23Í∞ú Îã®Ïñ¥</span>
                            <span class="last-studied">Ïñ¥Ï†ú</span>
                        </div>
                        <div class="progress-info">
                            <span class="progress-text">ÌïôÏäµ ÏßÑÌñâÎ•†</span>
                            <span class="progress-percent">12%</span>
                        </div>
                        <div class="mini-progress-bar">
                            <div class="mini-progress-fill" style="width: 12%;"></div>
                        </div>
                    </div>
                </div>

                <div class="wordbook-item" draggable="true" data-wordbook-id="5">
                    <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    <div class="wordbook-content">
                        <div class="wordbook-header">
                            <div class="wordbook-title">Í≥†Í∏â Ïñ¥Ìúò</div>
                            <div class="wordbook-icon">üéì</div>
                        </div>
                        <div class="wordbook-meta">
                            <span class="word-count">78Í∞ú Îã®Ïñ¥</span>
                            <span class="last-studied">1Ï£ºÏùº Ï†Ñ</span>
                        </div>
                        <div class="progress-info">
                            <span class="progress-text">ÌïôÏäµ ÏßÑÌñâÎ•†</span>
                            <span class="progress-percent">28%</span>
                        </div>
                        <div class="mini-progress-bar">
                            <div class="mini-progress-fill" style="width: 28%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Wordbook Button -->
            <button class="new-wordbook-btn" onclick="showNewWordbookModal()">
                ‚ûï ÏÉà Îã®Ïñ¥Ïû• ÎßåÎì§Í∏∞
            </button>
        </div>
    </div>

    <!-- Group Creation Modal -->
    <div class="group-modal-overlay" id="groupModal">
        <div class="group-modal">
            <h3 class="group-modal-title">ÏÉà Í∑∏Î£π ÎßåÎì§Í∏∞</h3>
            <div class="group-preview">
                <div class="group-preview-title">Í∑∏Î£πÏóê Ìè¨Ìï®Îê† Îã®Ïñ¥Ïû•:</div>
                <div class="group-preview-items" id="groupPreviewItems">
                    <!-- ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê® -->
                </div>
            </div>
            <input type="text" class="modal-input" id="groupNameInput" placeholder="Í∑∏Î£π Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" maxlength="20">
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="hideGroupModal()">
                    Ï∑®ÏÜå
                </button>
                <button class="modal-btn modal-btn-confirm" id="groupConfirmBtn" onclick="createGroup()" disabled>
                    Í∑∏Î£π ÎßåÎì§Í∏∞
                </button>
            </div>
        </div>
    </div>

    <!-- New Wordbook Modal -->
    <div class="modal-overlay" id="newWordbookModal">
        <div class="modal">
            <h3 class="modal-title">ÏÉà Îã®Ïñ¥Ïû• ÎßåÎì§Í∏∞</h3>
            <input type="text" class="modal-input" id="wordbookNameInput" placeholder="Îã®Ïñ¥Ïû• Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" maxlength="20">
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="hideNewWordbookModal()">
                    Ï∑®ÏÜå
                </button>
                <button class="modal-btn modal-btn-confirm" id="confirmBtn" onclick="createNewWordbook()" disabled>
                    ÎßåÎì§Í∏∞
                </button>
            </div>
        </div>
    </div>

    <script>
        // ÏÉà Îã®Ïñ¥Ïû• Î™®Îã¨ ÌëúÏãú
        function showNewWordbookModal() {
            document.getElementById('newWordbookModal').classList.add('show');
            document.getElementById('wordbookNameInput').focus();
        }

        // ÏÉà Îã®Ïñ¥Ïû• Î™®Îã¨ Ïà®Í∏∞Í∏∞
        function hideNewWordbookModal() {
            document.getElementById('newWordbookModal').classList.remove('show');
            document.getElementById('wordbookNameInput').value = '';
            document.getElementById('confirmBtn').disabled = true;
        }

        // ÏÉà Îã®Ïñ¥Ïû• ÎßåÎì§Í∏∞
        function createNewWordbook() {
            const name = document.getElementById('wordbookNameInput').value.trim();
            if (name) {
                // ÏÉà Îã®Ïñ¥Ïû• ÏÉùÏÑ± Î°úÏßÅ
                console.log('ÏÉà Îã®Ïñ¥Ïû• ÏÉùÏÑ±:', name);
                
                // Îã®Ïñ¥Ïû• Î™©Î°ùÏóê Ï∂îÍ∞Ä (ÏãúÎÆ¨Î†àÏù¥ÏÖò)
                addNewWordbookToList(name);
                
                // Î™®Îã¨ Îã´Í∏∞
                hideNewWordbookModal();
                
                // ÏÑ±Í≥µ Î©îÏãúÏßÄ
                alert(`"${name}" Îã®Ïñ¥Ïû•Ïù¥ ÎßåÎì§Ïñ¥Ï°åÏäµÎãàÎã§!`);
            }
        }

        // Îã®Ïñ¥Ïû• Î™©Î°ùÏóê ÏÉà Ìï≠Î™© Ï∂îÍ∞Ä
        function addNewWordbookToList(name) {
            const wordbookList = document.getElementById('wordbookList');
            const newItemId = 'wb-' + Date.now();
            const newItem = document.createElement('div');
            newItem.className = 'wordbook-item';
            newItem.draggable = true;
            newItem.setAttribute('data-wordbook-id', newItemId);
            newItem.innerHTML = `
                <div class="drag-handle">‚ãÆ‚ãÆ</div>
                <div class="wordbook-content">
                    <div class="wordbook-header">
                        <div class="wordbook-title">${name}</div>
                        <div class="wordbook-icon">üìù</div>
                    </div>
                    <div class="wordbook-meta">
                        <span class="word-count">0Í∞ú Îã®Ïñ¥</span>
                        <span class="last-studied">Î∞©Í∏à ÏÉùÏÑ±</span>
                    </div>
                    <div class="progress-info">
                        <span class="progress-text">ÌïôÏäµ ÏßÑÌñâÎ•†</span>
                        <span class="progress-percent">0%</span>
                    </div>
                    <div class="mini-progress-bar">
                        <div class="mini-progress-fill" style="width: 0%;"></div>
                    </div>
                </div>
            `;
            wordbookList.appendChild(newItem);
            
            // ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú ÏöîÏÜåÏóê Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
            setTimeout(() => {
                initializeDragAndDrop();
            }, 100);
        }

        // ÏûÖÎ†• Í∞êÏßÄ Î∞è Î≤ÑÌäº ÌôúÏÑ±Ìôî
        document.getElementById('wordbookNameInput').addEventListener('input', function() {
            const confirmBtn = document.getElementById('confirmBtn');
            confirmBtn.disabled = this.value.trim() === '';
        });

        // Enter ÌÇ§Î°ú Îã®Ïñ¥Ïû• ÎßåÎì§Í∏∞
        document.getElementById('wordbookNameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && this.value.trim() !== '') {
                createNewWordbook();
            }
        });

        // ESC ÌÇ§Î°ú Î™®Îã¨ Îã´Í∏∞
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideNewWordbookModal();
            }
        });

        // Î™®Îã¨ Î∞∞Í≤Ω ÌÅ¥Î¶≠ÏúºÎ°ú Îã´Í∏∞
        document.getElementById('newWordbookModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideNewWordbookModal();
            }
        });


        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Í¥ÄÎ†® Î≥ÄÏàò
        let draggedElement = null;
        let draggedData = null;
        let dragStartTime = null;
        let dragStartPosition = null;

        // Í∑∏Î£π Î™®Îã¨ Í¥ÄÎ†® Ìï®Ïàò
        function showGroupModal(sourceWordbook, targetWordbook) {
            const modal = document.getElementById('groupModal');
            const previewItems = document.getElementById('groupPreviewItems');
            const groupNameInput = document.getElementById('groupNameInput');
            
            // ÎØ∏Î¶¨Î≥¥Í∏∞ Ìï≠Î™© Ï∂îÍ∞Ä
            previewItems.innerHTML = `
                <div class="group-preview-item">${sourceWordbook.title}</div>
                <div class="group-preview-item">${targetWordbook.title}</div>
            `;
            
            // ÏûÑÏãú Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            window.tempGroupData = {
                source: sourceWordbook,
                target: targetWordbook
            };
            
            modal.classList.add('show');
            groupNameInput.focus();
        }

        function hideGroupModal() {
            const modal = document.getElementById('groupModal');
            const groupNameInput = document.getElementById('groupNameInput');
            const confirmBtn = document.getElementById('groupConfirmBtn');
            
            modal.classList.remove('show');
            groupNameInput.value = '';
            confirmBtn.disabled = true;
            
            // ÏûÑÏãú Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨
            delete window.tempGroupData;
        }

        function createGroup() {
            const groupName = document.getElementById('groupNameInput').value.trim();
            const groupData = window.tempGroupData;
            
            if (groupName && groupData) {
                console.log(`Í∑∏Î£π ÏÉùÏÑ±: ${groupName}`, groupData);
                
                // Í∑∏Î£π HTML ÏÉùÏÑ±
                const groupHTML = createGroupHTML(groupName, [groupData.source, groupData.target]);
                
                // ÏõêÎ≥∏ Îã®Ïñ¥Ïû•Îì§ Ï†úÍ±∞
                const sourceElement = document.querySelector(`[data-wordbook-id="${groupData.source.id}"]`);
                const targetElement = document.querySelector(`[data-wordbook-id="${groupData.target.id}"]`);
                
                const wordbookList = document.getElementById('wordbookList');
                
                // Í∑∏Î£πÏùÑ ÎåÄÏÉÅ Îã®Ïñ¥Ïû• ÏúÑÏπòÏóê Ï∂îÍ∞Ä
                if (targetElement) {
                    targetElement.insertAdjacentHTML('beforebegin', groupHTML);
                    targetElement.remove();
                }
                if (sourceElement && sourceElement !== targetElement) {
                    sourceElement.remove();
                }
                
                // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ïû¨Ï¥àÍ∏∞Ìôî
                setTimeout(() => {
                    initializeDragAndDrop();
                    // ÏÉàÎ°ú ÏÉùÏÑ±Îêú Í∑∏Î£π ÎÇ¥ Îã®Ïñ¥Ïû•Îì§Ïóê ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
                    setupGroupWordbookEvents();
                }, 100);
                
                hideGroupModal();
                alert(`"${groupName}" Í∑∏Î£πÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!`);
            }
        }

        function createGroupHTML(groupName, wordbooks) {
            const totalWords = wordbooks.reduce((sum, wb) => sum + parseInt(wb.wordCount), 0);
            const avgProgress = Math.round(wordbooks.reduce((sum, wb) => sum + wb.progress, 0) / wordbooks.length);
            
            const wordbookItems = wordbooks.map(wb => `
                <div class="wordbook-item" draggable="true" data-wordbook-id="${wb.id}">
                    <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    <div class="wordbook-content">
                        <div class="wordbook-header">
                            <div class="wordbook-title">${wb.title}</div>
                            <div class="wordbook-icon">${wb.icon}</div>
                        </div>
                        <div class="wordbook-meta">
                            <span class="word-count">${wb.wordCount}Í∞ú Îã®Ïñ¥</span>
                            <span class="last-studied">${wb.lastStudied}</span>
                        </div>
                        <div class="progress-info">
                            <span class="progress-text">ÌïôÏäµ ÏßÑÌñâÎ•†</span>
                            <span class="progress-percent">${wb.progress}%</span>
                        </div>
                        <div class="mini-progress-bar">
                            <div class="mini-progress-fill" style="width: ${wb.progress}%;"></div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            return `
                <div class="wordbook-group" draggable="true" data-group-id="group-${Date.now()}">
                    <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    <div class="group-header" onclick="toggleGroup(this)">
                        <div class="group-title">
                            <span class="group-name">${groupName}</span>
                            <span class="group-count">${wordbooks.length}</span>
                        </div>
                        <div class="group-toggle">‚ñ∂</div>
                    </div>
                    <div class="group-content">
                        ${wordbookItems}
                    </div>
                </div>
            `;
        }

        function toggleGroup(header) {
            const toggle = header.querySelector('.group-toggle');
            const content = header.parentElement.querySelector('.group-content');
            
            toggle.classList.toggle('expanded');
            content.classList.toggle('expanded');
        }

        function goToWordbook(wordbookId) {
            console.log(`Îã®Ïñ¥Ïû•ÏúºÎ°ú Ïù¥Îèô: ${wordbookId}`);
            window.location.href = 'wordbook-detail.html';
        }

        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
        function initializeDragAndDrop() {
            // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞Î•º ÏúÑÌï¥ Î™®Îì† ÏöîÏÜåÏùò Ïù¥Î≤§Ìä∏Î•º Ï†ïÎ¶¨
            const items = document.querySelectorAll('.wordbook-item, .wordbook-group');
            const container = document.getElementById('wordbookList');
            
            items.forEach(item => {
                // Ïù¥ÎØ∏ Ïù¥Î≤§Ìä∏Í∞Ä Ï∂îÍ∞ÄÎêú ÏöîÏÜåÎäî Ïä§ÌÇµ
                if (item.hasAttribute('data-drag-initialized')) {
                    return;
                }
                item.setAttribute('data-drag-initialized', 'true');
                
                // ÎìúÎûòÍ∑∏ ÏãúÏûë
                item.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    dragStartTime = Date.now();
                    dragStartPosition = { x: e.clientX, y: e.clientY };
                    
                    if (this.classList.contains('wordbook-item')) {
                        draggedData = extractWordbookData(this);
                    } else {
                        draggedData = extractGroupData(this);
                    }
                    
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', this.outerHTML);
                });
                
                // ÎìúÎûòÍ∑∏ Ï¢ÖÎ£å
                item.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    clearAllDropIndicators();
                    clearAllHighlights();
                    
                    draggedElement = null;
                    draggedData = null;
                    dragStartTime = null;
                    dragStartPosition = null;
                });
                
                // ÎìúÎ°≠ ÌóàÏö©
                item.addEventListener('dragover', function(e) {
                    if (draggedElement && draggedElement !== this) {
                        e.preventDefault();
                        e.dataTransfer.dropEffect = 'move';
                        
                        // ÎìúÎ°≠ ÏúÑÏπò Í≤∞Ï†ï
                        const rect = this.getBoundingClientRect();
                        const midY = rect.top + rect.height / 2;
                        const dropPosition = e.clientY < midY ? 'before' : 'after';
                        
                        // Ï§ëÏïô ÏòÅÏó≠ Ï≤¥ÌÅ¨ (Í∑∏Î£π ÏÉùÏÑ±Ïö©)
                        const dropX = e.clientX - rect.left;
                        const dropY = e.clientY - rect.top;
                        const isInCenterArea = dropX > rect.width * 0.2 && dropX < rect.width * 0.8 &&
                                             dropY > rect.height * 0.3 && dropY < rect.height * 0.7;
                        
                        // ÏãúÍ∞ÅÏ†Å ÌîºÎìúÎ∞±
                        clearAllHighlights();
                        
                        if (draggedElement.classList.contains('wordbook-item') && 
                            this.classList.contains('wordbook-group') &&
                            !isWordbookInGroup(draggedElement)) {
                            // Ïô∏Î∂Ä Îã®Ïñ¥Ïû•ÏùÑ Í∑∏Î£πÏóê Ï∂îÍ∞Ä Î™®Îìú
                            this.classList.add('drag-over-group');
                            clearAllDropIndicators();
                        } else if (draggedElement.classList.contains('wordbook-item') && 
                                 this.classList.contains('wordbook-item') &&
                                 isWordbookInGroup(draggedElement) && 
                                 isWordbookInGroup(this) &&
                                 getParentGroup(draggedElement) === getParentGroup(this)) {
                            // Í∞ôÏùÄ Í∑∏Î£π ÎÇ¥ ÏàúÏÑú Î≥ÄÍ≤Ω Î™®Îìú
                            this.classList.add('drag-over-reorder');
                            showDropIndicator(this, dropPosition);
                        } else if (isInCenterArea && 
                            draggedElement.classList.contains('wordbook-item') && 
                            this.classList.contains('wordbook-item') &&
                            !isWordbookInGroup(draggedElement) && !isWordbookInGroup(this)) {
                            // Ïô∏Î∂Ä Îã®Ïñ¥Ïû•ÎÅºÎ¶¨ Í∑∏Î£π ÏÉùÏÑ± Î™®Îìú
                            this.classList.add('drag-over-group');
                            clearAllDropIndicators();
                        } else {
                            // ÏùºÎ∞ò ÏàúÏÑú Î≥ÄÍ≤Ω Î™®Îìú
                            this.classList.add('drag-over-reorder');
                            showDropIndicator(this, dropPosition);
                        }
                    }
                });
                
                // ÎìúÎ°≠ Ï°¥ ÏßÑÏûÖ
                item.addEventListener('dragenter', function(e) {
                    if (draggedElement && draggedElement !== this) {
                        e.preventDefault();
                    }
                });
                
                // ÎìúÎ°≠ Ï°¥ Îñ†ÎÇòÍ∏∞
                item.addEventListener('dragleave', function(e) {
                    if (!this.contains(e.relatedTarget)) {
                        clearDropIndicator(this);
                    }
                });
                
                // ÎìúÎ°≠ Ï≤òÎ¶¨
                item.addEventListener('drop', function(e) {
                    e.preventDefault();
                    
                    if (draggedElement && draggedElement !== this) {
                        const dragDuration = Date.now() - dragStartTime;
                        const dragDistance = Math.sqrt(
                            Math.pow(e.clientX - dragStartPosition.x, 2) + 
                            Math.pow(e.clientY - dragStartPosition.y, 2)
                        );
                        
                        // ÎìúÎ°≠ ÏúÑÏπò Í≤∞Ï†ï
                        const rect = this.getBoundingClientRect();
                        const midY = rect.top + rect.height / 2;
                        const dropPosition = e.clientY < midY ? 'before' : 'after';
                        
                        // ÎìúÎ°≠ ÏúÑÏπòÍ∞Ä Ï§ëÏïô ÏòÅÏó≠Ïù∏ÏßÄ ÌôïÏù∏ (Í∑∏Î£π ÏÉùÏÑ±Ïö©)
                        const dropX = e.clientX - rect.left;
                        const dropY = e.clientY - rect.top;
                        const isInCenterArea = dropX > rect.width * 0.2 && dropX < rect.width * 0.8 &&
                                             dropY > rect.height * 0.3 && dropY < rect.height * 0.7;
                        
                        // ÎìúÎ°≠ ÎåÄÏÉÅÏóê Îî∞Î•∏ Ï≤òÎ¶¨
                        if (draggedElement.classList.contains('wordbook-item') && 
                            this.classList.contains('wordbook-group') &&
                            !isWordbookInGroup(draggedElement)) {
                            // Ïô∏Î∂Ä Îã®Ïñ¥Ïû•ÏùÑ Í∑∏Î£πÏóê ÎìúÎ°≠ - Í∑∏Î£πÏóê Ï∂îÍ∞Ä
                            addWordbookToGroup(draggedElement, this);
                        } else if (draggedElement.classList.contains('wordbook-item') && 
                                 this.classList.contains('wordbook-item') &&
                                 isWordbookInGroup(draggedElement) && 
                                 isWordbookInGroup(this) &&
                                 getParentGroup(draggedElement) === getParentGroup(this)) {
                            // Í∞ôÏùÄ Í∑∏Î£π ÎÇ¥ Îã®Ïñ¥Ïû•ÎÅºÎ¶¨ ÏàúÏÑú Î≥ÄÍ≤Ω
                            reorderWithinGroup(draggedElement, this, dropPosition);
                        } else if (isInCenterArea && 
                            draggedElement.classList.contains('wordbook-item') && 
                            this.classList.contains('wordbook-item') &&
                            !isWordbookInGroup(draggedElement) && !isWordbookInGroup(this)) {
                            // Ïô∏Î∂Ä Îã®Ïñ¥Ïû•ÎÅºÎ¶¨ Ï§ëÏïô ÎìúÎ°≠ - Í∑∏Î£π ÏÉùÏÑ±
                            const targetData = extractWordbookData(this);
                            showGroupModal(draggedData, targetData);
                        } else {
                            // ÏùºÎ∞ò ÏàúÏÑú Î≥ÄÍ≤Ω
                            reorderItems(draggedElement, this, dropPosition);
                        }
                    }
                    
                    clearAllDropIndicators();
                    clearAllHighlights();
                });

                // Îã®Ïñ¥Ïû• ÏΩòÌÖêÏ∏† ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ (wordbook-itemÎßå)
                if (item.classList.contains('wordbook-item')) {
                    const content = item.querySelector('.wordbook-content');
                    if (content && !item.hasAttribute('data-click-added')) {
                        content.addEventListener('click', function(e) {
                            e.stopPropagation();
                            goToWordbook(item.getAttribute('data-wordbook-id'));
                        });
                        item.setAttribute('data-click-added', 'true');
                    }
                }
            });
        }


        function extractWordbookData(element) {
            const titleElement = element.querySelector('.wordbook-title');
            const iconElement = element.querySelector('.wordbook-icon');
            const wordCountElement = element.querySelector('.word-count');
            const lastStudiedElement = element.querySelector('.last-studied');
            const progressElement = element.querySelector('.progress-percent');
            
            return {
                id: element.getAttribute('data-wordbook-id'),
                title: titleElement ? titleElement.textContent : '',
                icon: iconElement ? iconElement.textContent : 'üìö',
                wordCount: wordCountElement ? parseInt(wordCountElement.textContent) : 0,
                lastStudied: lastStudiedElement ? lastStudiedElement.textContent : '',
                progress: progressElement ? parseInt(progressElement.textContent) : 0
            };
        }

        function extractGroupData(element) {
            const nameElement = element.querySelector('.group-name');
            const countElement = element.querySelector('.group-count');
            
            return {
                id: element.getAttribute('data-group-id') || 'group-' + Date.now(),
                name: nameElement ? nameElement.textContent : '',
                count: countElement ? parseInt(countElement.textContent) : 0,
                type: 'group'
            };
        }

        // ÎìúÎ°≠ Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ Í¥ÄÎ†® Ìï®ÏàòÎì§
        function showDropIndicator(targetElement, position) {
            clearAllDropIndicators();
            
            const indicator = document.createElement('div');
            indicator.className = 'drop-indicator show';
            indicator.setAttribute('data-drop-indicator', 'true');
            
            try {
                if (position === 'before') {
                    targetElement.parentNode.insertBefore(indicator, targetElement);
                } else {
                    targetElement.parentNode.insertBefore(indicator, targetElement.nextSibling);
                }
            } catch (error) {
                console.error('ÎìúÎ°≠ Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ ÌëúÏãú Ïã§Ìå®:', error, targetElement);
            }
        }

        function clearDropIndicator(targetElement) {
            const indicators = targetElement.parentNode.querySelectorAll('.drop-indicator');
            indicators.forEach(indicator => indicator.remove());
        }

        function clearAllDropIndicators() {
            const indicators = document.querySelectorAll('.drop-indicator');
            indicators.forEach(indicator => indicator.remove());
        }

        function clearAllHighlights() {
            document.querySelectorAll('.wordbook-item, .wordbook-group').forEach(item => {
                item.classList.remove('drag-over-group', 'drag-over-reorder');
            });
        }

        // Îã®Ïñ¥Ïû•ÏùÑ Í∑∏Î£πÏóê Ï∂îÍ∞ÄÌïòÎäî Ìï®Ïàò
        function addWordbookToGroup(wordbookElement, groupElement) {
            const wordbookData = extractWordbookData(wordbookElement);
            const groupContent = groupElement.querySelector('.group-content');
            const groupCount = groupElement.querySelector('.group-count');
            
            // ÏõêÎ≥∏ Îã®Ïñ¥Ïû•ÏùÑ Í∑∏Î£π ÎÇ¥Î∂ÄÎ°ú ÏßÅÏ†ë Ïù¥Îèô (Î≥µÏÇ¨Í∞Ä ÏïÑÎãå Ïù¥Îèô)
            wordbookElement.removeAttribute('data-drag-initialized');
            
            // Í∏∞Ï°¥ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï†úÍ±∞ÌïòÍ≥† ÏÉàÎ°ú Ï∂îÍ∞Ä
            const existingContent = wordbookElement.querySelector('.wordbook-content');
            if (existingContent) {
                existingContent.onclick = () => goToWordbook(wordbookData.id);
            }
            
            // Í∑∏Î£π ÎÇ¥Ïö©Ïóê ÏßÅÏ†ë Ïù¥Îèô
            groupContent.appendChild(wordbookElement);
            
            // Í∑∏Î£π Ïπ¥Ïö¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            const currentCount = parseInt(groupCount.textContent);
            groupCount.textContent = currentCount + 1;
            
            // Í∑∏Î£π ÌéºÏπòÍ∏∞
            const groupToggle = groupElement.querySelector('.group-toggle');
            if (!groupToggle.classList.contains('expanded')) {
                groupToggle.classList.add('expanded');
                groupContent.classList.add('expanded');
            }
            
            console.log(`"${wordbookData.title}" Îã®Ïñ¥Ïû•Ïù¥ Í∑∏Î£πÏóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.`);
            
            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ïû¨Ï¥àÍ∏∞Ìôî
            setTimeout(() => {
                initializeDragAndDrop();
                setupGroupWordbookEvents();
            }, 100);
        }

        // Îã®Ïñ¥Ïû•Ïù¥ Í∑∏Î£π ÎÇ¥Î∂ÄÏóê ÏûàÎäîÏßÄ ÌôïÏù∏
        function isWordbookInGroup(wordbookElement) {
            return wordbookElement.closest('.wordbook-group') !== null;
        }

        // Îã®Ïñ¥Ïû•Ïùò Î∂ÄÎ™® Í∑∏Î£π Î∞òÌôò
        function getParentGroup(wordbookElement) {
            return wordbookElement.closest('.wordbook-group');
        }

        // Í∑∏Î£π ÎÇ¥ Îã®Ïñ¥Ïû•Îì§Ïóê ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï
        function setupGroupWordbookEvents() {
            const groupWordbooks = document.querySelectorAll('.wordbook-group .wordbook-item .wordbook-content');
            groupWordbooks.forEach(content => {
                const wordbookItem = content.closest('.wordbook-item');
                const wordbookId = wordbookItem.getAttribute('data-wordbook-id');
                
                // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Ï†úÍ±∞
                content.onclick = null;
                
                // ÏÉà ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
                content.addEventListener('click', function(e) {
                    e.stopPropagation();
                    goToWordbook(wordbookId);
                });
            });
        }

        // Í∑∏Î£π ÎÇ¥ÏóêÏÑú Îã®Ïñ¥Ïû• ÏàúÏÑú Î≥ÄÍ≤Ω
        function reorderWithinGroup(draggedElement, targetElement, position) {
            const groupContent = targetElement.closest('.group-content');
            
            // ÎìúÎûòÍ∑∏ Ï¥àÍ∏∞Ìôî ÏÜçÏÑ± Ï†úÍ±∞
            draggedElement.removeAttribute('data-drag-initialized');
            
            // ÏÉà ÏúÑÏπòÏóê ÏÇΩÏûÖ
            if (position === 'before') {
                groupContent.insertBefore(draggedElement, targetElement);
            } else {
                groupContent.insertBefore(draggedElement, targetElement.nextSibling);
            }
            
            console.log('Í∑∏Î£π ÎÇ¥ ÏàúÏÑú Î≥ÄÍ≤Ω ÏôÑÎ£å:', draggedData, position, 'target:', targetElement);
            
            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ïû¨Ï¥àÍ∏∞Ìôî
            setTimeout(() => {
                initializeDragAndDrop();
            }, 100);
        }

        // ÏàúÏÑú Î≥ÄÍ≤Ω Ìï®Ïàò
        function reorderItems(draggedElement, targetElement, position) {
            const container = document.getElementById('wordbookList');
            
            // ÎìúÎûòÍ∑∏ Ï¥àÍ∏∞Ìôî ÏÜçÏÑ± Ï†úÍ±∞
            draggedElement.removeAttribute('data-drag-initialized');
            
            // ÏÉà ÏúÑÏπòÏóê ÏÇΩÏûÖ
            if (position === 'before') {
                container.insertBefore(draggedElement, targetElement);
            } else {
                container.insertBefore(draggedElement, targetElement.nextSibling);
            }
            
            console.log('ÏàúÏÑú Î≥ÄÍ≤Ω ÏôÑÎ£å:', draggedData, position, 'target:', targetElement);
            
            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ïû¨Ï¥àÍ∏∞Ìôî
            setTimeout(() => {
                initializeDragAndDrop();
            }, 100);
        }

        // Í∑∏Î£π Î™®Îã¨ ÏûÖÎ†• Í∞êÏßÄ
        document.getElementById('groupNameInput').addEventListener('input', function() {
            const confirmBtn = document.getElementById('groupConfirmBtn');
            confirmBtn.disabled = this.value.trim() === '';
        });

        // Enter ÌÇ§Î°ú Í∑∏Î£π ÎßåÎì§Í∏∞
        document.getElementById('groupNameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && this.value.trim() !== '') {
                createGroup();
            }
        });

        // ESC ÌÇ§Î°ú Í∑∏Î£π Î™®Îã¨ Îã´Í∏∞
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideGroupModal();
            }
        });

        // Í∑∏Î£π Î™®Îã¨ Î∞∞Í≤Ω ÌÅ¥Î¶≠ÏúºÎ°ú Îã´Í∏∞
        document.getElementById('groupModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideGroupModal();
            }
        });

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            initializeDragAndDrop();
        });
    </script>
</body>
</html>